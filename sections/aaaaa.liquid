{% comment %}
  Glow Product Mapper â€“ Revised: Loads collection products as cards for selected vehicle
{% endcomment %}

{% assign selected_collections = section.settings.vehicle_collections %}
{% assign default_vehicle_handles = 'jeep,truck' | split: ',' %}
{% assign vehicle_collections = selected_collections | default: default_vehicle_handles %}

<div class="tr-heading-container" style="text-align: center">
  {% if section.settings.heading != blank %}
    <h2 class="tr-heading">{{ section.settings.heading }}</h2>
  {% endif %}
  {% if section.settings.subtext != blank %}
    <p class="tr-subheading">{{ section.settings.subtext }}</p>
  {% endif %}
</div>

<div class="tr-vehicle-selector-wrapper">
  <div class="tr-vehicle-selector">
    {% for collection_handle in vehicle_collections %}
      {% assign handle = collection_handle.handle | default: collection_handle %}
      {% assign vehicle_collection = collections[handle] %}
      {% if vehicle_collection %}
        <button class="tr-vehicle-btn {% if forloop.first %}active{% endif %}" data-vehicle="{{ handle }}">
          <img src="{{ vehicle_collection.image | image_url: '300x300' }}" width="" height="" alt="{{ handle }}">
          <span>{{ handle | upcase }}</span>
        </button>
      {% endif %}
    {% endfor %}
  </div>
</div>

<div class="tr-container">
  <div class="tr-image-map-wrapper">
    <div class="tr-main-image-carousel">
      <button class="tr-carousel-arrow left">&#10094;</button>
      <div class="tr-carousel-images">
        {% for collection_handle in vehicle_collections %}
          {% assign handle = collection_handle.handle | default: collection_handle %}
          {% assign vehicle_collection = collections[handle] %}
          {% if vehicle_collection %}
            <img
              src="{{ vehicle_collection.image | image_url: '800x600' }}"
              width=""
              height=""
              data-vehicle="{{ handle }}"
            >
          {% endif %}
        {% endfor %}
      </div>
      <button class="tr-carousel-arrow right">&#10095;</button>
    </div>
    <div id="markerContainer"></div>
  </div>
  <div class="tr-card-carousel" id="cardStack"></div>
</div>

<script type="application/json" id="vehicleData">
  {
    {% for collection_handle in vehicle_collections %}
      {% assign handle = collection_handle.handle | default: collection_handle %}
      {% assign current_collection = collections[handle] %}
      "{{ handle }}": [
        {% if current_collection.products.size > 0 %}
          {% for product in current_collection.products %}
            {
              "title": {{ product.title | json }},
              "price": {{ product.price | money | json }},
              "img": {{ product.featured_image | image_url: '600x600' | json }},
              "pos": {{ product.metafields.custom.position | json }}
            }{% unless forloop.last %},{% endunless %}
          {% endfor %}
        {% endif %}
      ]{% unless forloop.last %},{% endunless %}
    {% endfor %}
  }
</script>

<script src="{{ 'abc.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Glow Product Mapper",
  "tag": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Section Heading", "default": "Vehicle Part Mapper" },
    { "type": "textarea", "id": "subtext", "label": "Subheading", "default": "Explore our parts by vehicle below." },
    { "type": "collection_list", "id": "vehicle_collections", "label": "Vehicle Collections", "limit": 5 }
  ],
  "presets": [{ "name": "Glow Product Mapper", "category": "Custom" }]
}
{% endschema %}
